#!/usr/bin/env bash

# Make sure inbound/bus and outbound/bus exist
mkdir -p routes/inbound/bus
mkdir -p routes/outbound/bus

# These come from the error message when passing a bad ID at http://127.0.0.1:4000/route-sequence-by-line-direction?line=thebus&direction=outbound
for bus_line in '1' '100' '101' '102' '103' '104' '105' '106' '107' '108' '109' '11' '110' '111' '112' '113' '114' '115' '116' '117' '119' '12' '120' '121' '122' '123' '124' '125' '126' '127' '128' '129' '13' '130' '131' '132' '133' '134' '135' '136' '137' '138' '139' '14' '140' '141' '142' '143' '144' '145' '146' '147' '148' '149' '15' '150' '151' '152' '153' '154' '155' '156' '157' '158' '159' '16' '160' '161' '162' '163' '164' '165' '166' '167' '169' '17' '170' '171' '172' '173' '174' '175' '176' '177' '178' '179' '18' '180' '181' '182' '183' '184' '185' '186' '187' '188' '189' '19' '190' '191' '192' '193' '194' '195' '196' '197' '198' '199' '2' '20' '200' '201' '202' '203' '204' '205' '206' '207' '208' '209' '21' '210' '211' '212' '213' '214' '215' '216' '217' '218' '219' '22' '220' '221' '222' '223' '224' '225' '226' '227' '228' '229' '23' '230' '231' '232' '233' '234' '235' '236' '237' '238' '24' '240' '241' '242' '243' '244' '245' '246' '247' '248' '249' '25' '250' '251' '252' '253' '254' '255' '256' '257' '258' '259' '26' '260' '261' '262' '263' '264' '265' '266' '267' '268' '269' '27' '270' '272' '273' '274' '275' '276' '277' '278' '279' '28' '280' '281' '282' '283' '284' '285' '286' '287' '288' '289' '29' '290' '291' '292' '293' '294' '295' '296' '297' '298' '299' '3' '30' '300' '301' '302' '303' '304' '306' '307' '308' '309' '31' '310' '312' '313' '314' '315' '316' '317' '318' '319' '32' '320' '321' '322' '323' '324' '325' '326' '327' '328' '329' '33' '330' '331' '333' '335' '336' '337' '339' '34' '340' '341' '343' '344' '345' '346' '349' '35' '350' '352' '353' '354' '355' '356' '357' '358' '359' '36' '360' '362' '363' '364' '365' '366' '367' '368' '37' '370' '371' '372' '375' '376' '377' '378' '379' '38' '380' '381' '382' '383' '384' '385' '386' '388' '389' '39' '390' '393' '394' '395' '396' '397' '398' '399' '4' '40' '401' '403' '404' '405' '406' '407' '41' '410' '411' '412' '413' '415' '417' '418' '419' '42' '422' '423' '424' '425' '427' '428' '43' '430' '432' '433' '434' '436' '439' '44' '440' '444' '45' '450' '452' '453' '456' '46' '460' '462' '463' '464' '465' '466' '467' '468' '469' '47' '470' '472' '473' '474' '476' '481' '482' '483' '484' '485' '486' '487' '488' '49' '490' '491' '492' '493' '496' '498' '499' '5' '50' '51' '52' '53' '533' '54' '55' '56' '57' '58' '59' '6' '60' '601' '602' '603' '605' '606' '608' '61' '612' '613' '616' '617' '618' '62' '621' '624' '625' '626' '627' '628' '629' '63' '631' '632' '633' '634' '635' '638' '639' '64' '640' '642' '643' '645' '646' '649' '65' '650' '651' '652' '653' '654' '655' '656' '657' '658' '66' '660' '661' '662' '663' '664' '665' '667' '669' '67' '670' '671' '672' '673' '674' '675' '677' '678' '679' '68' '681' '683' '684' '685' '686' '687' '688' '689' '69' '690' '696' '697' '698' '699' '7' '70' '71' '72' '73' '74' '75' '76' '77' '78' '79' '8' '80' '81' '83' '85' '86' '87' '88' '89' '9' '90' '91' '92' '93' '94' '95' '96' '969' '97' '98' '99' 'a10' 'b11' 'b12' 'b13' 'b14' 'b15' 'b16' 'c1' 'c10' 'c11' 'c3' 'd3' 'd6' 'd7' 'd8' 'e1' 'e10' 'e11' 'e2' 'e3' 'e5' 'e6' 'e7' 'e8' 'e9' 'el1' 'el2' 'el3' 'g1' 'h10' 'h11' 'h12' 'h13' 'h14' 'h17' 'h18' 'h19' 'h2' 'h20' 'h22' 'h25' 'h26' 'h28' 'h3' 'h32' 'h37' 'h9' 'h91' 'h98' 'k1' 'k2' 'k3' 'k4' 'k5' 'n1' 'n109' 'n11' 'n113' 'n133' 'n136' 'n137' 'n140' 'n15' 'n155' 'n171' 'n18' 'n19' 'n199' 'n2' 'n20' 'n205' 'n207' 'n21' 'n22' 'n242' 'n25' 'n250' 'n253' 'n26' 'n263' 'n266' 'n27' 'n277' 'n279' 'n28' 'n29' 'n3' 'n31' 'n32' 'n33' 'n343' 'n38' 'n381' 'n41' 'n44' 'n5' 'n53' 'n55' 'n550' 'n551' 'n63' 'n65' 'n68' 'n7' 'n72' 'n73' 'n74' 'n8' 'n83' 'n86' 'n87' 'n89' 'n9' 'n91' 'n97' 'n98' 'p12' 'p13' 'p4' 'p5' 'r1' 'r10' 'r11' 'r2' 'r3' 'r4' 'r5' 'r68' 'r7' 'r70' 'r8' 'r9' 's1' 's2' 's3' 's4' 'sl1' 'sl10' 'sl2' 'sl3' 'sl5' 'sl6' 'sl7' 'sl8' 'sl9' 'u1' 'u10' 'u2' 'u3' 'u4' 'u5' 'u7' 'u9' 'w11' 'w12' 'w13' 'w14' 'w15' 'w16' 'w19' 'w3' 'w4' 'w5' 'w6' 'w7' 'w8' 'w9'; do
  echo "Fetching inbound route for line $bus_line..."
  wget -q \
       "http://127.0.0.1:4000/route-sequence-by-line-direction?line=$bus_line&direction=inbound" \
       -O "routes/inbound/bus/$bus_line.json"

  # Check if download failed (e.g., server error or no file)
  if [ $? -ne 0 ]; then
    echo "Failed to download inbound route for line $bus_line"
    exit 1
  fi

  # Check the 'success' key in the JSON
  inbound_success=$(jq -r '.success' "routes/inbound/bus/$bus_line.json" 2>/dev/null)
  if [ "$inbound_success" = "false" ]; then
    echo "Inbound route for line $bus_line returned success=false. Stopping."
    exit 1
  fi

  echo "Fetching outbound route for line $bus_line..."
  wget -q \
       "http://127.0.0.1:4000/route-sequence-by-line-direction?line=$bus_line&direction=outbound" \
       -O "routes/outbound/bus/$bus_line.json"

  if [ $? -ne 0 ]; then
    echo "Failed to download outbound route for line $bus_line"
    exit 1
  fi

  outbound_success=$(jq -r '.success' "routes/outbound/bus/$bus_line.json" 2>/dev/null)
  if [ "$outbound_success" = "false" ]; then
    echo "Outbound route for line $bus_line returned success=false. Stopping."
    exit 1
  fi
done
